!function(){var requirejs,require,define;!function(undef){function hasProp(obj,prop){return hasOwn.call(obj,prop)}function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,lastIndex,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{};if(name&&"."===name.charAt(0))if(baseName){for(name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),name=baseParts.slice(0,baseParts.length-1).concat(name),i=0;i<name.length;i+=1)if(part=name[i],"."===part)name.splice(i,1),i-=1;else if(".."===part){if(1===i&&(".."===name[2]||".."===name[0]))break;i>0&&(name.splice(i-1,2),i-=2)}name=name.join("/")}else 0===name.indexOf("./")&&(name=name.substring(2));if((baseParts||starMap)&&map){for(nameParts=name.split("/"),i=nameParts.length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if(mapValue=map[baseParts.slice(0,j).join("/")],mapValue&&(mapValue=mapValue[nameSegment])){foundMap=mapValue,foundI=i;break}if(foundMap)break;!foundStarMap&&starMap&&starMap[nameSegment]&&(foundStarMap=starMap[nameSegment],starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return name}function makeRequire(relName,forceSync){return function(){var args=aps.call(arguments,0);return"string"!=typeof args[0]&&1===args.length&&args.push(null),req.apply(undef,args.concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name],defining[name]=!0,main.apply(undef,args)}if(!hasProp(defined,name)&&!hasProp(defining,name))throw new Error("No "+name);return defined[name]}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice,jsSuffixRegExp=/\.js$/;makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];return name=parts[1],prefix&&(prefix=normalize(prefix,relName),plugin=callDep(prefix)),prefix?name=plugin&&plugin.normalize?plugin.normalize(name,makeNormalize(relName)):normalize(name,relName):(name=normalize(name,relName),parts=splitPrefix(name),prefix=parts[0],name=parts[1],prefix&&(plugin=callDep(prefix))),{f:prefix?prefix+"!"+name:name,n:name,pr:prefix,p:plugin}},handlers={require:function(name){return makeRequire(name)},exports:function(name){var e=defined[name];return"undefined"!=typeof e?e:defined[name]={}},module:function(name){return{id:name,uri:"",exports:defined[name],config:makeConfig(name)}}},main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,usingExports,args=[],callbackType=typeof callback;if(relName=relName||name,"undefined"===callbackType||"function"===callbackType){for(deps=!deps.length&&callback.length?["require","exports","module"]:deps,i=0;i<deps.length;i+=1)if(map=makeMap(deps[i],relName),depName=map.f,"require"===depName)args[i]=handlers.require(name);else if("exports"===depName)args[i]=handlers.exports(name),usingExports=!0;else if("module"===depName)cjsModule=args[i]=handlers.module(name);else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName))args[i]=callDep(depName);else{if(!map.p)throw new Error(name+" missing "+depName);map.p.load(map.n,makeRequire(relName,!0),makeLoad(depName),{}),args[i]=defined[depName]}ret=callback?callback.apply(defined[name],args):void 0,name&&(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]?defined[name]=cjsModule.exports:ret===undef&&usingExports||(defined[name]=ret))}else name&&(defined[name]=callback)},requirejs=require=req=function(deps,callback,relName,forceSync,alt){if("string"==typeof deps)return handlers[deps]?handlers[deps](callback):callDep(makeMap(deps,callback).f);if(!deps.splice){if(config=deps,config.deps&&req(config.deps,config.callback),!callback)return;callback.splice?(deps=callback,callback=relName,relName=null):deps=undef}return callback=callback||function(){},"function"==typeof relName&&(relName=forceSync,forceSync=alt),forceSync?main(undef,deps,callback,relName):setTimeout(function(){main(undef,deps,callback,relName)},4),req},req.config=function(cfg){return req(cfg)},requirejs._defined=defined,define=function(name,deps,callback){if("string"!=typeof name)throw new Error("See almond README: incorrect module build, no module name");deps.splice||(callback=deps,deps=[]),hasProp(defined,name)||hasProp(waiting,name)||(waiting[name]=[name,deps,callback])},define.amd={jQuery:!0}}(),define("bower_components/almond/almond",function(){}),function(root,factory){"function"==typeof define&&define.amd?define("WCommunicator",[],factory):root.WindowCommunicator=factory()}(this,function(){var WindowCommunicator=function(target,source,targetOrigin,messageReceivedCallBack){if(!target)return console.error("WindowCommunicator: Error target must be specified.");this.target=target,this.source=source||window,this.targetOrigin=targetOrigin||"*",this.handshake=!1,this.queue=[];var cb=messageReceivedCallBack||function(){console.debug("WindowCommunicator: message received but no callback has been set")};this.setMessageReceivedCallBack=function(messageReceivedCallBack){return"function"!=typeof messageReceivedCallBack?console.error("WindowCommunicator: Unable to set callback:",messageReceivedCallBack):void(this.messageReceivedCallBack=messageReceivedCallBack)},this.post=function(message){this.queue.push(message),privates.processQueue()};var self=this,privates={handshakeKey:"WindowCommunicatorHanshake",addListener:function(){self.source.addEventListener("message",privates.receiveMessage,!1),privates.sendHandshake()},sendHandshake:function(){privates.sendMessage(privates.handshakeKey)},handleHandshake:function(){self.handshake||(self.handshake=!0,privates.sendHandshake(),privates.processQueue())},processQueue:function(){self.handshake&&self.queue.length&&(privates.sendMessage(self.queue.shift()),privates.processQueue())},sendMessage:function(message){self.target.postMessage(message,self.targetOrigin)},receiveMessage:function(event){return event&&event.origin===self.targetOrigin?event.data===privates.handshakeKey?privates.handleHandshake():void(self.handshake&&self.messageReceivedCallBack&&self.messageReceivedCallBack(event.data)):void 0}};this.__testonly_privates__=privates,this.setMessageReceivedCallBack(cb),privates.addListener()};return WindowCommunicator}),function(factory){if("function"==typeof define&&define.amd)define("Cookies",factory);else if("object"==typeof exports)module.exports=factory();else{var _OldCookies=window.Cookies,api=window.Cookies=factory(window.jQuery);api.noConflict=function(){return window.Cookies=_OldCookies,api}}}(function(){function extend(){for(var i=0,result={};i<arguments.length;i++){var attributes=arguments[i];for(var key in attributes)result[key]=attributes[key]}return result}function init(converter){function api(key,value,attributes){var result;if(arguments.length>1){if(attributes=extend({path:"/"},api.defaults,attributes),"number"==typeof attributes.expires){var expires=new Date;expires.setMilliseconds(expires.getMilliseconds()+864e5*attributes.expires),attributes.expires=expires}try{result=JSON.stringify(value),/^[\{\[]/.test(result)&&(value=result)}catch(e){}return value=encodeURIComponent(String(value)),value=value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),key=encodeURIComponent(String(key)),key=key.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),key=key.replace(/[\(\)]/g,escape),document.cookie=[key,"=",value,attributes.expires&&"; expires="+attributes.expires.toUTCString(),attributes.path&&"; path="+attributes.path,attributes.domain&&"; domain="+attributes.domain,attributes.secure?"; secure":""].join("")}key||(result={});for(var cookies=document.cookie?document.cookie.split("; "):[],rdecode=/(%[0-9A-Z]{2})+/g,i=0;i<cookies.length;i++){var parts=cookies[i].split("="),name=parts[0].replace(rdecode,decodeURIComponent),cookie=parts.slice(1).join("=");'"'===cookie.charAt(0)&&(cookie=cookie.slice(1,-1));try{if(cookie=converter&&converter(cookie,name)||cookie.replace(rdecode,decodeURIComponent),this.json)try{cookie=JSON.parse(cookie)}catch(e){}if(key===name){result=cookie;break}key||(result[name]=cookie)}catch(e){}}return result}return api.get=api.set=api,api.getJSON=function(){return api.apply({json:!0},[].slice.call(arguments))},api.defaults={},api.remove=function(key,attributes){api(key,"",extend(attributes,{expires:-1}))},api.withConverter=init,api}return init()}),function(root,factory){"function"==typeof define&&define.amd?define("src/mastertagdebug",["WCommunicator","Cookies"],factory):root.mastertagdebug=factory(root.WindowCommunicator,root.Cookies)}(this,function(WCommunicator,Cookies){function buildIframe(doc){var partnerId=Cookies.get("criteoTagDebugMode");if(!partnerId)return console.error("Error: TagDebugMode cookie not set (should be set with partnerId).");var iFrameUrl=INTEGRATE_URL+"/debug?partnerId="+partnerId,iframe=doc.createElement("iframe");return iframe.id=IFRAME_ID,iframe.style.position="fixed",iframe.style.bottom=0,iframe.style.left=0,iframe.style.height="300px",iframe.style.width="100%",iframe.style.borderStyle="none",iframe.style.zIndex=2147483647,iframe.style.transition="height 400ms",iframe.setAttribute("src",iFrameUrl),iframe.setAttribute("scrolling","no"),iframe}function transformQueue(doc,queue,iframe){var wCommunicator;queue.sendMessageToTagDebugModeIFrame=function(type,payload){return wCommunicator&&"function"==typeof wCommunicator.post?void wCommunicator.post({type:type,payload:payload}):console.error("Error: unable to post messsage to iFrame")};var requestPayloadFromArguments=function(args){for(var debugArgs=[],i=0;i<args.length;i++){var arg=args[i],debugArg={};for(var prop in arg)if(arg.hasOwnProperty(prop)){var newProperty;switch(prop){case"element":newProperty={tagName:arg[prop].tagName,src:arg[prop].src};break;default:newProperty=arg[prop]}debugArg[prop]=newProperty}debugArgs.push(debugArg)}return debugArgs},tagDebugModePush=function(){var requestPayload=requestPayloadFromArguments(arguments);queue.sendMessageToTagDebugModeIFrame("request",requestPayload);var argsArrayForOriginalPush=[].slice.call(arguments);argsArrayForOriginalPush.push({event:"setParameter",tag_debug_mode:1}),queue.originalPush.apply(queue,argsArrayForOriginalPush)},tagDebugModePushError=function(errorObject){queue.sendMessageToTagDebugModeIFrame("error",errorObject)},receiveMessageFromIFrame=function(message,doc){if(message)switch(message.type){case"disable-criteo-tag-debug-mode":deActivateTagDebugMode();break;case"resize-criteo-tag-debug-mode":resizeTagDebugMode(message.height);break;default:console.warn("Unrecognized message received from iFrame")}},deActivateTagDebugMode=function(){doc.cookie="criteoTagDebugMode=; path=/; expires=Thu, 01 Jan 1970 00:00:00 UTC";var iFrame=doc.getElementById(IFRAME_ID);iFrame.parentElement.removeChild(iFrame),queue.push=queue.originalPush,queue.pushError=function(){}},resizeTagDebugMode=function(height){height&&(iframe.style.height=height)},start=function(){wCommunicator=new WCommunicator(iframe.contentWindow,null,INTEGRATE_URL,function(msg){receiveMessageFromIFrame(msg,doc)}),queue.push=tagDebugModePush,queue.pushError=tagDebugModePushError,queue.stagedErrors.forEach(function(error){tagDebugModePushError(error)}),queue.stagedPushes.forEach(function(push){tagDebugModePush.apply(queue,push)}),iframe.removeEventListener("load",start)};iframe.addEventListener("load",start)}var IFRAME_ID="criteoTagDebugModeIFrame",INTEGRATE_URL="http://integrate.criteo.preprod",privates={buildIframe:buildIframe,transformQueue:transformQueue},mastertagdebug={init:function(win){if(!win.criteo_q)return console.error("Error: Unable to find Criteo's master tag.");if(!win.criteo_q.originalPush||!win.criteo_q.stagedPushes||!win.criteo_q.stagedErrors)return console.error("Error: Criteo master tag not configured for Tag Debug Mode.");var iframe=privates.buildIframe(win.document);privates.transformQueue(win.document,win.criteo_q,iframe),win.document.body?win.document.body.appendChild(iframe):win.addEventListener("load",function(){win.document.body.appendChild(iframe)})},__testonly_privates__:privates};return mastertagdebug}),requirejs.config({paths:{WCommunicator:"bower_components/window-communicator/src/window-communicator",Cookies:"bower_components/js-cookie/src/js.cookie"},shim:{}}),require(["src/mastertagdebug"],function(mastertagdebug){mastertagdebug.init(window)}),define("src/main",function(){})}();
